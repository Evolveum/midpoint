<!--
  ~ Copyright (C) 2010-2025 Evolveum and contributors
  ~
  ~ This work is dual-licensed under the Apache License 2.0
  ~ and European Union Public License. See LICENSE file for details.
  -->

<task xmlns="http://midpoint.evolveum.com/xml/ns/public/common/common-3"
        oid="50a4d2af-4302-4268-99db-ff49895242d5">
    <name>Composite noop</name>
    <ownerRef oid="00000000-0000-0000-0000-000000000002" type="UserType"/>
    <executionState>runnable</executionState>
    <activity>
        <composition>
            <activity>
                <identifier>activity to be restarted</identifier>
                <work>
                    <noOp>
                        <steps>5</steps>
                        <delay>400</delay>
                    </noOp>
                </work>
                <policies>
                    <policy>
                        <name>Max. 1s execution</name>
                        <description>
                            Restart activity only once after it's executing for more than 1s.
                            In the next run leave it until it's done.
                        </description>
                        <policyConstraints>
                            <executionTime>
                                <exceeds>PT1S</exceeds>
                            </executionTime>
                            <restartActivity>
                                <below>1</below>
                            </restartActivity>
                        </policyConstraints>
                        <policyReaction>
                            <name>restart activity</name>
                            <action>
                                <restartActivity>
                                    <delay>1000</delay>
                                </restartActivity>
                            </action>
                        </policyReaction>
                    </policy>
                </policies>
            </activity>
            <activity>
                <identifier>activity to be skipped</identifier>
                <work>
                    <noOp>
                        <steps>5</steps>
                        <delay>400</delay>
                    </noOp>
                </work>
                <policies>
                    <policy>
                        <name>Max. 1s execution</name>
                        <policyConstraints>
                            <executionTime/>
                        </policyConstraints>
                        <policyReaction>
                            <name>skip activity</name>
                            <threshold>
                                <lowWaterMark>
                                    <duration>PT1S</duration>
                                </lowWaterMark>
                            </threshold>
                            <action>
                                <skipActivity/>
                            </action>
                        </policyReaction>
                    </policy>
                </policies>
            </activity>
            <activity>
                <identifier>activity to suspend</identifier>
                <work>
                    <noOp>
                        <steps>5</steps>
                        <delay>400</delay>
                    </noOp>
                </work>
                <policies>
                    <policy>
                        <name>Max. 1s execution</name>
                        <policyConstraints>
                            <executionTime/>
                        </policyConstraints>
                        <policyReaction>
                            <name>notification and suspend</name>
                            <threshold>
                                <lowWaterMark>
                                    <duration>PT1S</duration>
                                </lowWaterMark>
                            </threshold>
                            <action>
                                <notification/>
                                <suspendTask/>
                            </action>
                        </policyReaction>
                    </policy>
                </policies>
            </activity>
        </composition>
    </activity>
</task>
