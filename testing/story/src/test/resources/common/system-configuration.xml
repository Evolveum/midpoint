<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!--
  ~ Copyright (c) 2010-2017 Evolveum and contributors
  ~
  ~ Licensed under the EUPL-1.2 or later.
  -->

<systemConfiguration oid="00000000-0000-0000-0000-000000000001" version="0"
    xmlns="http://midpoint.evolveum.com/xml/ns/public/common/common-3"
    xmlns:c="http://midpoint.evolveum.com/xml/ns/public/common/common-3"
    xmlns:q="http://prism.evolveum.com/xml/ns/public/query-3">
    <name>SystemConfiguration</name>
    <logging>
        <rootLoggerAppender>File Appender</rootLoggerAppender>
        <rootLoggerLevel>INFO</rootLoggerLevel>
        <classLogger>
            <level>TRACE</level>
            <package>com.evolveum.midpoint.common.LoggingConfigurationManager</package>
          </classLogger>
        <c:classLogger>
            <c:level>TRACE</c:level>
            <c:package>com.evolveum.midpoint.notifications</c:package>
        </c:classLogger>
        <appender xsi:type="c:FileAppenderConfigurationType" name="File Appender" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
            <pattern>%date [%thread] %-5level \(%logger{46}\): %message%n</pattern>
            <fileName>target/test.log</fileName>
            <append>true</append>
        </appender>
    </logging>
    <audit>
        <eventRecording>
            <recordResourceStageChanges>false</recordResourceStageChanges>
        </eventRecording>
    </audit>
    <notificationConfiguration>
        <handler>
            <simpleWorkflowNotifier>
                <category>workItemLifecycleEvent</category>
                <transport>dummy:workItemLifecycle</transport>
            </simpleWorkflowNotifier>
            <simpleWorkflowNotifier>
                <category>workItemAllocationEvent</category>
                <transport>dummy:workItemAllocation</transport>
            </simpleWorkflowNotifier>
            <simpleWorkflowNotifier>
                <category>workItemCustomEvent</category>
                <transport>dummy:workItemCustom</transport>
            </simpleWorkflowNotifier>
            <simpleWorkflowNotifier>
                <category>workflowProcessEvent</category>
                <transport>dummy:process</transport>
            </simpleWorkflowNotifier>
        </handler>
        <mail>
            <redirectToFile>target/mail-notifications.log</redirectToFile>
        </mail>
    </notificationConfiguration>
    <workflowConfiguration>
        <useDefaultApprovalPolicyRules>never</useDefaultApprovalPolicyRules>
    </workflowConfiguration>
    <simulation>
        <metric>
            <identifier>objects-added</identifier>
            <computation>
                <selection>
                    <expression>
                        <script>
                            <code>processedObject.addition</code>
                        </script>
                    </expression>
                </selection>
            </computation>
        </metric>
        <metric>
            <identifier>objects-modified</identifier>
            <computation>
                <selection>
                    <expression>
                        <script>
                            <code>processedObject.modification</code>
                        </script>
                    </expression>
                </selection>
            </computation>
        </metric>
        <metric>
            <identifier>objects-deleted</identifier>
            <computation>
                <selection>
                    <expression>
                        <script>
                            <code>processedObject.deletion</code>
                        </script>
                    </expression>
                </selection>
            </computation>
        </metric>
        <metric>
            <identifier>objects-unmodified</identifier>
            <computation>
                <selection>
                    <expression>
                        <script>
                            <code>processedObject.noChange</code>
                        </script>
                    </expression>
                </selection>
            </computation>
        </metric>
        <metric>
            <identifier>pct-objects-added</identifier>
            <aggregation>
                <aggregationFunction>domainTotalValueToDomainSize</aggregationFunction>
                <source>
                    <identifier>objects-added</identifier>
                </source>
            </aggregation>
        </metric>
        <metric>
            <identifier>pct-objects-deleted</identifier>
            <aggregation>
                <aggregationFunction>domainTotalValueToDomainSize</aggregationFunction>
                <source>
                    <identifier>objects-deleted</identifier>
                </source>
            </aggregation>
        </metric>
        <metric>
            <identifier>item-modifications</identifier>
            <documentation>The number of non-operational item modifications. Applies to all kinds of objects.</documentation>
            <computation>
                <valueExpression>
                    <script>
                        <code>processedObject.nonOperationalItemModificationsCount</code>
                    </script>
                </valueExpression>
            </computation>
        </metric>
        <metric>
            <identifier>attribute-modifications</identifier>
            <computation>
                <domain>
                    <expression>
                        <script>
                            <code>processedObject.isShadow()</code>
                        </script>
                    </expression>
                </domain>
                <valueExpression>
                    <script>
                        <code>processedObject.attributeModificationsCount</code>
                    </script>
                </valueExpression>
            </computation>
        </metric>
        <metric>
            <identifier>association-values-changed</identifier>
            <computation>
                <domain>
                    <expression>
                        <script>
                            <code>processedObject.isShadow()</code>
                        </script>
                    </expression>
                </domain>
                <valueExpression>
                    <script>
                        <code>processedObject.associationValuesChanged</code>
                    </script>
                </valueExpression>
            </computation>
        </metric>
        <metric>
            <identifier>avg-focus-modifications</identifier>
            <aggregation>
                <aggregationFunction>domainTotalValueToDomainSize</aggregationFunction>
                <source>
                    <identifier>modifications</identifier>
                </source>
                <domainRestriction>
                    <expression>
                        <script>
                            <!-- The original metric applies to all objects. Here we are interested in focal objects only. -->
                            <code>processedObject.isOfFocusType()</code>
                        </script>
                    </expression>
                </domainRestriction>
            </aggregation>
        </metric>
        <metric>
            <identifier>pct-users-enabled</identifier>
            <aggregation>
                <aggregationFunction>domainTotalValueToDomainSize</aggregationFunction>
                <source>
                    <eventMarkRef oid="00000000-0000-0000-0000-000000000710"/>
                </source>
                <domainRestriction>
                    <filter>
                        <q:equal>
                            <q:path>type</q:path>
                            <q:value>c:UserType</q:value>
                        </q:equal>
                    </filter>
                </domainRestriction>
            </aggregation>
        </metric>
        <metric>
            <identifier>pct-users-disabled</identifier>
            <aggregation>
                <aggregationFunction>domainTotalValueToDomainSize</aggregationFunction>
                <source>
                    <eventMarkRef oid="00000000-0000-0000-0000-000000000711"/>
                </source>
                <domainRestriction>
                    <filter>
                        <q:equal>
                            <q:path>type</q:path>
                            <q:value>c:UserType</q:value>
                        </q:equal>
                    </filter>
                </domainRestriction>
            </aggregation>
        </metric>
    </simulation>
</systemConfiguration>
