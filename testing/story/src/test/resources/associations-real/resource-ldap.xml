<!--
  ~ Copyright (C) 2010-2024 Evolveum and contributors
  ~
  ~ This work is dual-licensed under the Apache License 2.0
  ~ and European Union Public License. See LICENSE file for details.
  -->

<resource xmlns="http://midpoint.evolveum.com/xml/ns/public/common/common-3"
        xmlns:c="http://midpoint.evolveum.com/xml/ns/public/common/common-3"
        xmlns:q="http://prism.evolveum.com/xml/ns/public/query-3"
        xmlns:ri="http://midpoint.evolveum.com/xml/ns/public/resource/instance-3"
        xmlns:t="http://prism.evolveum.com/xml/ns/public/types-3"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        oid="052a29b1-cde5-4546-9787-916e4a846f2e">
    <name>AD</name>
    <description>ExAmPLE, Inc. AD resource</description>
    <lifecycleState>active</lifecycleState>
    <connectorRef>
        <filter>
            <q:text>connectorType = "com.evolveum.polygon.connector.ldap.LdapConnector" and available = "true"</q:text>
        </filter>
    </connectorRef>
    <connectorConfiguration xmlns:icfc="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/connector-schema-3">
        <icfc:configurationProperties xmlns:cfg="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/bundle/com.evolveum.polygon.connector-ldap/com.evolveum.polygon.connector.ldap.LdapConnector">
            <cfg:port>10389</cfg:port>
            <cfg:host>localhost</cfg:host>
            <cfg:baseContext>dc=example,dc=com</cfg:baseContext>
            <cfg:bindDn>cn=directory manager</cfg:bindDn>
            <cfg:bindPassword><t:clearValue>secret</t:clearValue></cfg:bindPassword>
            <cfg:pagingStrategy>auto</cfg:pagingStrategy>
            <cfg:vlvSortAttribute>entryUUID</cfg:vlvSortAttribute>
            <cfg:operationalAttributes>ds-pwp-account-disabled</cfg:operationalAttributes>
            <cfg:operationalAttributes>isMemberOf</cfg:operationalAttributes>
            <cfg:usePermissiveModify>always</cfg:usePermissiveModify>
            <cfg:managedAssociationPairs>"inetOrgPerson"+isMemberOf -# "groupOfNames"+member</cfg:managedAssociationPairs>
            <!--<cfg:passwordHashAlgorithm>SSHA</cfg:passwordHashAlgorithm>-->
        </icfc:configurationProperties>
    </connectorConfiguration>
    <schema>
        <generationConstraints>
            <generateObjectClass>ri:inetOrgPerson</generateObjectClass>
            <generateObjectClass>ri:groupOfUniqueNames</generateObjectClass>
            <generateObjectClass>ri:groupOfNames</generateObjectClass>
            <generateObjectClass>ri:organizationalUnit</generateObjectClass>
        </generationConstraints>
    </schema>
    <schemaHandling>
        <objectType>
            <kind>account</kind>
            <intent>default</intent>
            <displayName>Normal Account</displayName>
            <lifecycleState>active</lifecycleState>
            <default>true</default>
            <delineation>
                <objectClass>ri:inetOrgPerson</objectClass>
            </delineation>
            <focus>
                <type>UserType</type>
            </focus>
            <attribute>
                <ref>ri:dn</ref>
                <displayName>Distinguished Name</displayName>
                <limitations>
                    <minOccurs>0</minOccurs>
                </limitations>
                <outbound>
                    <name>mapping-dn</name>
                    <description>Returns either CN=John Smith,... or CN=John Smith (jsmith2),... to make it unique and avoid iterator in CN/DN.</description>
                    <lifecycleState>active</lifecycleState>
                    <strength>strong</strength>
                    <source>
                        <path>name</path>
                    </source>
                    <source>
                        <path>fullName</path>
                    </source>
                    <expression>
                        <script>
                            <code>def cn
                            if (iteration == 0) {
                                cn = fullName
                            } else {
                                cn = fullName + ' (' + name + ')'
                            }
                            return basic.composeDnWithSuffix('cn', cn,
                                    'ou=users,' + basic.getResourceIcfConfigurationPropertyValue(resource, 'baseContext')
                            )</code>
                        </script>
                    </expression>
                </outbound>
            </attribute>
            <attribute>
                <ref>ri:cn</ref>
                <displayName>Common Name</displayName>
                <limitations>
                    <minOccurs>0</minOccurs>
                    <maxOccurs>1</maxOccurs>
                </limitations>
                <outbound>
                    <name>mapping-cn-weak</name>
                    <description>Returns user's fullName or fullName with username to make it unique and avoid iterator in CN.</description>
                    <lifecycleState>active</lifecycleState>
                    <strength>weak</strength>
                    <source>
                        <path>name</path>
                    </source>
                    <source>
                        <path>fullName</path>
                    </source>
                    <expression>
                        <script>
                            <code>def cn
                            if (iteration == 0) {
                                cn = fullName
                            } else {
                                cn = fullName + ' (' + name + ')'
                            }
                            return cn</code>
                        </script>
                    </expression>
                </outbound>
            </attribute>
            <attribute>
                <ref>ri:entryUUID</ref>
                <displayName>Entry UUID</displayName>
                <limitations>
                    <access>
                        <read>true</read>
                        <add>false</add>
                        <modify>true</modify>
                    </access>
                </limitations>
            </attribute>
            <attribute>
                <ref>ri:displayName</ref>
                <displayName>Display Name</displayName>
                <limitations>
                    <minOccurs>0</minOccurs>
                    <maxOccurs>1</maxOccurs>
                </limitations>
                <outbound>
                    <name>mapping-displayName</name>
                    <lifecycleState>active</lifecycleState>
                    <strength>strong</strength>
                    <source>
                        <path>fullName</path>
                    </source>
                </outbound>
            </attribute>
            <attribute>
                <ref>ri:sn</ref>
                <displayName>Surname</displayName>
                <limitations>
                    <maxOccurs>1</maxOccurs>
                </limitations>
                <outbound>
                    <name>mapping-sn</name>
                    <lifecycleState>active</lifecycleState>
                    <strength>strong</strength>
                    <source>
                        <path>familyName</path>
                    </source>
                </outbound>
                <inbound>
                    <name>mapping-inbound-familyName-for-correlation</name>
                    <target>
                        <path>familyName</path>
                    </target>
                    <use>correlation</use>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:givenName</ref>
                <displayName>Given Name</displayName>
                <limitations>
                    <maxOccurs>1</maxOccurs>
                </limitations>
                <outbound>
                    <name>mapping-givenName</name>
                    <lifecycleState>active</lifecycleState>
                    <strength>strong</strength>
                    <source>
                        <path>givenName</path>
                    </source>
                </outbound>
                <inbound>
                    <name>mapping-inbound-givenName-for-correlation</name>
                    <target>
                        <path>givenName</path>
                    </target>
                    <use>correlation</use>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:uid</ref>
                <displayName>Login Name (sAMAccountName)</displayName>
                <limitations>
                    <maxOccurs>1</maxOccurs>
                </limitations>
                <secondaryIdentifier>true</secondaryIdentifier>
                <outbound>
                    <name>mapping-uid</name>
                    <lifecycleState>active</lifecycleState>
                    <strength>strong</strength>
                    <source>
                        <path>name</path>
                    </source>
                </outbound>
                <inbound>
                    <name>mapping-inbound-username-to-name-for-import</name>
                    <lifecycleState>archived</lifecycleState>
                    <strength>strong</strength>
                    <target>
                        <path>name</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:mail</ref>
                <displayName>E-mail address</displayName>
                <outbound>
                    <name>mapping-mail</name>
                    <lifecycleState>draft</lifecycleState>
                    <strength>strong</strength>
                    <source>
                        <path>emailAddress</path>
                    </source>
                </outbound>
            </attribute>
            <attribute>
                <ref>ri:description</ref>
                <limitations>
                    <minOccurs>0</minOccurs>
                    <maxOccurs>1</maxOccurs>
                </limitations>
                <outbound>
                    <name>mapping-description</name>
                    <lifecycleState>draft</lifecycleState>
                    <strength>strong</strength>
                    <source>
                        <path>description</path>
                    </source>
                </outbound>
            </attribute>
            <attribute>
                <ref>ri:title</ref>
                <limitations>
                    <minOccurs>0</minOccurs>
                    <maxOccurs>1</maxOccurs>
                </limitations>
                <outbound>
                    <name>mapping-title</name>
                    <lifecycleState>active</lifecycleState>
                    <strength>strong</strength>
                    <source>
                        <path>title</path>
                    </source>
                </outbound>
            </attribute>
            <attribute>
                <ref>ri:jpegPhoto</ref>
                <displayName>User photo</displayName>
                <limitations>
                    <maxOccurs>1</maxOccurs>
                </limitations>
                <outbound>
                    <name>mapping-jpegPhoto</name>
                    <lifecycleState>draft</lifecycleState>
                    <strength>strong</strength>
                    <source>
                        <path>jpegPhoto</path>
                    </source>
                </outbound>
            </attribute>
            <attribute>
                <ref>ri:l</ref>
                <displayName>Locality</displayName>
                <limitations>
                    <minOccurs>0</minOccurs>
                    <maxOccurs>1</maxOccurs>
                </limitations>
                <outbound>
                    <name>mapping-l</name>
                    <lifecycleState>active</lifecycleState>
                    <strength>strong</strength>
                    <source>
                        <path>locality</path>
                    </source>
                </outbound>
                <inbound>
                    <name>mapping-inbound-locality-for-correlation</name>
                    <target>
                        <path>locality</path>
                    </target>
                    <use>correlation</use>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:employeeNumber</ref>
                <displayName>Employee number</displayName>
                <outbound>
                    <name>mapping-employeeNumber</name>
                    <lifecycleState>active</lifecycleState>
                    <strength>strong</strength>
                    <source>
                        <path>personalNumber</path>
                    </source>
                </outbound>
                <inbound>
                    <name>mapping-inbound-employeeNumber-for-correlation</name>
                    <target>
                        <path>personalNumber</path>
                    </target>
                    <use>correlation</use>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:initials</ref>
                <outbound>
                    <name>mapping-initials</name>
                    <lifecycleState>active</lifecycleState>
                    <strength>strong</strength>
                    <source>
                        <path>givenName</path>
                    </source>
                    <source>
                        <path>familyName</path>
                    </source>
                    <expression>
                        <script>
                            <code>basic.uc(
                                    basic.stringify(givenName)?.take(1) +
                                            basic.stringify(familyName)?.take(1)
                            )</code>
                        </script>
                    </expression>
                </outbound>
            </attribute>
            <iteration>
                <maxIterations>2</maxIterations>
            </iteration>
            <marking>
                <markRef oid="00000000-0000-0000-0000-000000000800" type="MarkType"/>
                <applicationTime>always</applicationTime>
                <pattern>
                    <filter>
                        <q:text>attributes/ri:dn =[stringIgnoreCase] 'cn=idm,ou=Administrators,dc=example,dc=com'</q:text>
                    </filter>
                </pattern>
                <pattern>
                    <filter>
                        <q:text>attributes/ri:dn =[stringIgnoreCase] 'cn=admin,dc=example,dc=com'</q:text>
                    </filter>
                </pattern>
                <pattern>
                    <filter>
                        <q:text>attributes/ri:dn =[stringIgnoreCase] 'cn=Mail Service Account,ou=users,dc=example,dc=com'</q:text>
                    </filter>
                </pattern>
                <pattern>
                    <filter>
                        <q:text>attributes/ri:dn =[stringIgnoreCase] 'cn=Spam Assassin Service Account,ou=users,dc=example,dc=com'</q:text>
                    </filter>
                </pattern>
            </marking>
            <marking>
                <markRef oid="00000000-0000-0000-0000-000000000803" type="MarkType"/>
                <applicationTime>always</applicationTime>
                <pattern>
                    <filter>
                        <q:text>attributes/ri:dn =[stringIgnoreCase] 'cn=Test123,ou=users,dc=example,dc=com'</q:text>
                        <q:description>This is the Test123 account (present in training LDAP), marked as Do not touch</q:description>
                    </filter>
                </pattern>
            </marking>
            <activation>
                <administrativeStatus>
                    <outbound>
                        <name>set-account-status-based-on-midpoint-user</name>
                        <lifecycleState>active</lifecycleState>
                        <strength>strong</strength>
                    </outbound>
                </administrativeStatus>
                <disableInsteadOfDelete>
                    <lifecycleState>active</lifecycleState>
                </disableInsteadOfDelete>
                <delayedDelete>
                    <lifecycleState>active</lifecycleState>
                    <deleteAfter>PT5M</deleteAfter>
                </delayedDelete>
            </activation>
            <credentials>
                <password>
                    <outbound>
                        <name>initial-passwd-generate</name>
                        <description>Set initial password if empty</description>
                        <lifecycleState>active</lifecycleState>
                        <strength>weak</strength>
                        <expression>
                            <generate/>
                        </expression>
                    </outbound>
                    <outbound>
                        <name>passwd-change</name>
                        <description>Copy password from midPoint when changed</description>
                        <lifecycleState>active</lifecycleState>
                        <strength>normal</strength>
                    </outbound>
                </password>
            </credentials>
            <correlation>
                <correlators>
                    <items>
                        <name>personalNumber-correlation</name>
                        <description>Correlation using personalNumber. Please note: inbound mapping for personalNumber is used only during correlation.</description>
                        <enabled>true</enabled>
                        <item>
                            <ref>personalNumber</ref>
                        </item>
                        <composition>
                            <tier>1</tier>
                        </composition>
                    </items>
                    <items>
                        <name>last-resort-correlation</name>
                        <description>Correlation using givenName, familyName and locality. We trust it only for 50% (manual correlation/confirmation is needed).
                            Please note: inbound mappings are used only during correlation. This correlator is disabled by default.
                        </description>
                        <enabled>true</enabled>
                        <item>
                            <ref>givenName</ref>
                        </item>
                        <item>
                            <ref>familyName</ref>
                        </item>
                        <item>
                            <ref>locality</ref>
                        </item>
                        <composition>
                            <tier>10</tier>
                            <weight>0.5</weight>
                        </composition>
                    </items>
                </correlators>
            </correlation>
            <synchronization>
                <reaction>
                    <name>unlinked-link</name>
                    <lifecycleState>active</lifecycleState>
                    <situation>unlinked</situation>
                    <actions>
                        <link/>
                    </actions>
                </reaction>
                <reaction>
                    <name>linked-synchronize</name>
                    <lifecycleState>active</lifecycleState>
                    <situation>linked</situation>
                    <actions>
                        <synchronize/>
                    </actions>
                </reaction>
                <reaction>
                    <name>deleted-synchronize</name>
                    <description>Synchronize causes also account to be recreated if assigned. This requires the dead shadow exist.</description>
                    <lifecycleState>active</lifecycleState>
                    <situation>deleted</situation>
                    <actions>
                        <synchronize/>
                    </actions>
                </reaction>
                <reaction>
                    <name>unmatched-deleteResourceObject</name>
                    <situation>unmatched</situation>
                    <actions>
                        <deleteResourceObject/>
                    </actions>
                </reaction>
                <reaction>
                    <name>disputed-create-case</name>
                    <situation>disputed</situation>
                    <actions>
                        <createCorrelationCase/>
                    </actions>
                </reaction>
            </synchronization>
        </objectType>
        <objectType>
            <kind>entitlement</kind>
            <intent>ad-group</intent>
            <displayName>AD Group</displayName>
            <description>Internal AD Groups</description>
            <lifecycleState>active</lifecycleState>
            <default>true</default>
            <delineation>
                <objectClass>ri:groupOfNames</objectClass>
                <filter>
                    <q:text>attributes/cn not startsWith "app:"</q:text>
                </filter>
            </delineation>
            <focus>
                <type>c:RoleType</type>
                <archetypeRef oid="8053bbaa-6578-442d-a7a6-9c5b39b8a389" type="ArchetypeType"/>
            </focus>
            <attribute>
                <ref>ri:cn</ref>
                <outbound>
                    <name>identifier-to-cn</name>
                    <strength>weak</strength>
                    <source>
                        <path>identifier</path>
                    </source>
                </outbound>
                <inbound>
                    <name>cn-into-identifier</name>
                    <strength>strong</strength>
                    <target>
                        <path>identifier</path>
                    </target>
                </inbound>
                <inbound>
                    <name>cn-into-name</name>
                    <strength>strong</strength>
                    <expression>
                        <script>
                            <code>"ad:" + input</code>
                        </script>
                    </expression>
                    <target>
                        <path>name</path>
                    </target>
                </inbound>
                <inbound>
                    <name>cn-into-displayName</name>
                    <strength>strong</strength>
                    <expression>
                        <script>
                            <code>"AD: " + input?.replace('-', ' ')?.capitalize()</code>
                        </script>
                    </expression>
                    <target>
                        <path>displayName</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:description</ref>
                <tolerant>false</tolerant>
                <outbound>
                    <name>description-to-description</name>
                    <strength>strong</strength>
                    <source>
                        <path>description</path>
                    </source>
                </outbound>
                <inbound>
                    <name>description-into-description</name>
                    <strength>strong</strength>
                    <target>
                        <path>description</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:businessCategory</ref>
                <inbound>
                    <name>businessCategory-into-costCenter</name>
                    <strength>strong</strength>
                    <target>
                        <path>costCenter</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:dn</ref>
                <outbound>
                    <name>identifier-to-dn</name>
                    <strength>strong</strength>
                    <source>
                        <path>identifier</path>
                    </source>
                    <expression>
                        <script>
                            <code>basic.composeDnWithSuffix('cn', identifier,
                                    'ou=groups,' + basic.getResourceIcfConfigurationPropertyValue(resource,
                                            'baseContext')
                            )</code>
                        </script>
                    </expression>
                </outbound>
            </attribute>
            <defaultOperationPolicy>
                <policyRef oid="00000000-0000-0000-0000-000000000805" type="MarkType"/>
                <lifecycleState>active</lifecycleState>
            </defaultOperationPolicy>
            <correlation>
                <correlators>
                    <items>
                        <name>group-correlation-by-identifier</name>
                        <enabled>true</enabled>
                        <item>
                            <ref>identifier</ref>
                        </item>
                    </items>
                </correlators>
            </correlation>
            <synchronization>
                <reaction>
                    <name>unmatched-add</name>
                    <lifecycleState>active</lifecycleState>
                    <situation>unmatched</situation>
                    <actions>
                        <addFocus/>
                    </actions>
                </reaction>
                <reaction>
                    <name>unlinked-link</name>
                    <situation>unlinked</situation>
                    <actions>
                        <link/>
                    </actions>
                </reaction>
                <reaction>
                    <name>linked-synchronize</name>
                    <situation>linked</situation>
                    <actions>
                        <synchronize/>
                    </actions>
                </reaction>
                <reaction>
                    <name>deleted-inactivate</name>
                    <lifecycleState>active</lifecycleState>
                    <situation>deleted</situation>
                    <actions>
                        <inactivateFocus/>
                    </actions>
                </reaction>
            </synchronization>
        </objectType>
        <objectType>
            <kind>entitlement</kind>
            <intent>app-group</intent>
            <displayName>AD Application Group</displayName>
            <description>Application groups provided by AD</description>
            <lifecycleState>active</lifecycleState>
            <default>false</default>
            <delineation>
                <objectClass>ri:groupOfNames</objectClass>
                <filter>
                    <q:text>attributes/cn startsWith "app:"</q:text>
                </filter>
            </delineation>
            <focus>
                <type>c:RoleType</type>
                <archetypeRef oid="c43e59cf-c2ff-4dc8-93c9-bc32c6ce308a" type="ArchetypeType"/>
            </focus>
            <attribute>
                <ref>ri:cn</ref>
                <outbound>
                    <name>identifier-to-cn</name>
                    <strength>weak</strength>
                    <source>
                        <path>identifier</path>
                    </source>
                </outbound>
                <inbound>
                    <name>cn-into-identifier</name>
                    <strength>strong</strength>
                    <target>
                        <path>identifier</path>
                    </target>
                </inbound>
                <inbound>
                    <name>cn-into-name</name>
                    <strength>strong</strength>
                    <expression>
                        <script>
                            <code>"ad:" + input</code>
                        </script>
                    </expression>
                    <target>
                        <path>name</path>
                    </target>
                </inbound>
                <inbound>
                    <name>cn-into-displayName</name>
                    <strength>strong</strength>
                    <expression>
                        <script>
                            <code>separator = ':'
                            parsed = input?.split(separator)
                            if (parsed?.size() == 3 &amp;&amp; input?.startsWith('app:')) {
                                appName = parsed[1] // second component (application name)
                                roleName = parsed[2] // everything after second component is role name
                                return "AD app: " +
                                        appName?.replace('-', ' ')?.capitalize() +
                                        separator +
                                        roleName?.replace('-', ' ')?.capitalize()
                            } else {
                                return "AD app: " + input?.replace('-', ' ')?.capitalize()
                            }</code>
                        </script>
                    </expression>
                    <target>
                        <path>displayName</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:description</ref>
                <tolerant>false</tolerant>
                <outbound>
                    <name>description-to-description</name>
                    <strength>strong</strength>
                    <source>
                        <path>description</path>
                    </source>
                </outbound>
                <inbound>
                    <name>description-into-description</name>
                    <strength>strong</strength>
                    <target>
                        <path>description</path>
                    </target>
                </inbound>
            </attribute>
            <attribute>
                <ref>ri:businessCategory</ref>
            </attribute>
            <attribute>
                <ref>ri:dn</ref>
                <outbound>
                    <name>identifier-to-dn</name>
                    <strength>strong</strength>
                    <source>
                        <path>identifier</path>
                    </source>
                    <expression>
                        <script>
                            <code>basic.composeDnWithSuffix('cn', identifier,
                                    'ou=appgroups,' + basic.getResourceIcfConfigurationPropertyValue(resource,
                                            'baseContext')
                            )</code>
                        </script>
                    </expression>
                </outbound>
            </attribute>
            <defaultOperationPolicy>
                <policyRef oid="00000000-0000-0000-0000-000000000805" type="MarkType"/>
                <lifecycleState>active</lifecycleState>
            </defaultOperationPolicy>
            <correlation>
                <correlators>
                    <items>
                        <name>group-correlation-by-identifier</name>
                        <enabled>true</enabled>
                        <item>
                            <ref>identifier</ref>
                        </item>
                    </items>
                </correlators>
            </correlation>
            <synchronization>
                <reaction>
                    <name>unmatched-add</name>
                    <lifecycleState>active</lifecycleState>
                    <situation>unmatched</situation>
                    <actions>
                        <addFocus/>
                    </actions>
                </reaction>
                <reaction>
                    <name>unlinked-link</name>
                    <situation>unlinked</situation>
                    <actions>
                        <link/>
                    </actions>
                </reaction>
                <reaction>
                    <name>linked-synchronize</name>
                    <situation>linked</situation>
                    <actions>
                        <synchronize/>
                    </actions>
                </reaction>
                <reaction>
                    <name>deleted-inactivate</name>
                    <situation>deleted</situation>
                    <actions>
                        <inactivateFocus/>
                    </actions>
                </reaction>
            </synchronization>
        </objectType>
        <associationType>
            <name>adGroup-association</name>
            <displayName>AD Group Association</displayName>
            <description>Association for AD groups (under ou=groups)</description>
            <lifecycleState>active</lifecycleState>
            <subject>
                <objectType>
                    <kind>account</kind>
                    <intent>default</intent>
                </objectType>
                <association>
                    <ref>adGroup</ref>
                    <sourceAttributeRef>ri:group</sourceAttributeRef>
                    <outbound>
                        <name>role-assignments-to-ad-group-membership</name>
                        <strength>strong</strength>
                        <expression>
                            <associationConstruction xsi:type="AssociationConstructionExpressionEvaluatorType">
                                <objectRef>
                                    <ref>ri:group</ref>
                                    <mapping>
                                        <name>associationFromLink</name>
                                        <strength>strong</strength>
                                        <expression>
                                            <associationFromLink/>
                                        </expression>
                                    </mapping>
                                </objectRef>
                            </associationConstruction>
                        </expression>
                    </outbound>
                    <inbound>
                        <name>group-membership-to-role-assignments</name>
                        <strength>strong</strength>
                        <expression>
                            <associationSynchronization xsi:type="AssociationSynchronizationExpressionEvaluatorType">
                                <objectRef>
                                    <ref>ri:group</ref>
                                    <mapping>
                                        <name>shadowOwner-into-targetRef</name>
                                        <strength>strong</strength>
                                        <expression>
                                            <shadowOwnerReferenceSearch/>
                                        </expression>
                                        <target>
                                            <path>targetRef</path>
                                        </target>
                                    </mapping>
                                </objectRef>
                                <correlation>
                                    <correlators>
                                        <items>
                                            <name>membership-correlation</name>
                                            <enabled>true</enabled>
                                            <item>
                                                <ref>targetRef</ref>
                                            </item>
                                        </items>
                                    </correlators>
                                </correlation>
                                <synchronization>
                                    <reaction>
                                        <name>unmatched-add</name>
                                        <situation>unmatched</situation>
                                        <actions>
                                            <addFocusValue/>
                                        </actions>
                                    </reaction>
                                    <reaction>
                                        <name>matched-synchronize</name>
                                        <situation>matched</situation>
                                        <actions>
                                            <synchronize/>
                                        </actions>
                                    </reaction>
                                    <reaction>
                                        <name>indirectly-matched-ignore</name>
                                        <situation>matchedIndirectly</situation>
                                    </reaction>
                                </synchronization>
                            </associationSynchronization>
                        </expression>
                    </inbound>
                </association>
            </subject>
            <object>
                <objectType>
                    <kind>entitlement</kind>
                    <intent>ad-group</intent>
                </objectType>
            </object>
        </associationType>
        <associationType>
            <name>appgroup-association</name>
            <displayName>AD Application Group Association</displayName>
            <description>Association for AD application groups (under ou=appgroups)</description>
            <lifecycleState>active</lifecycleState>
            <subject>
                <objectType>
                    <kind>account</kind>
                    <intent>default</intent>
                </objectType>
                <association>
                    <ref>appGroup</ref>
                    <sourceAttributeRef>ri:group</sourceAttributeRef>
                    <outbound>
                        <name>role-assignments-to-app-group-membership</name>
                        <strength>strong</strength>
                        <expression>
                            <associationConstruction xsi:type="AssociationConstructionExpressionEvaluatorType">
                                <objectRef>
                                    <ref>ri:group</ref>
                                    <mapping>
                                        <name>associationFromLink</name>
                                        <strength>strong</strength>
                                        <expression>
                                            <associationFromLink/>
                                        </expression>
                                    </mapping>
                                </objectRef>
                            </associationConstruction>
                        </expression>
                    </outbound>
                    <inbound>
                        <name>group-membership-to-role-assignments</name>
                        <strength>strong</strength>
                        <expression>
                            <associationSynchronization xsi:type="AssociationSynchronizationExpressionEvaluatorType">
                                <objectRef>
                                    <ref>ri:group</ref>
                                    <mapping>
                                        <name>shadowOwner-into-targetRef</name>
                                        <strength>strong</strength>
                                        <expression>
                                            <shadowOwnerReferenceSearch/>
                                        </expression>
                                        <target>
                                            <path>targetRef</path>
                                        </target>
                                    </mapping>
                                </objectRef>
                                <correlation>
                                    <correlators>
                                        <items>
                                            <name>membership-correlation</name>
                                            <enabled>true</enabled>
                                            <item>
                                                <ref>targetRef</ref>
                                            </item>
                                        </items>
                                    </correlators>
                                </correlation>
                                <synchronization>
                                    <reaction>
                                        <name>unmatched-add</name>
                                        <situation>unmatched</situation>
                                        <actions>
                                            <addFocusValue/>
                                        </actions>
                                    </reaction>
                                    <reaction>
                                        <name>matched-synchronize</name>
                                        <situation>matched</situation>
                                        <actions>
                                            <synchronize/>
                                        </actions>
                                    </reaction>
                                    <reaction>
                                        <name>indirectly-matched-ignore</name>
                                        <situation>matchedIndirectly</situation>
                                    </reaction>
                                </synchronization>
                            </associationSynchronization>
                        </expression>
                    </inbound>
                </association>
            </subject>
            <object>
                <objectType>
                    <kind>entitlement</kind>
                    <intent>app-group</intent>
                </objectType>
            </object>
        </associationType>
    </schemaHandling>
    <capabilities>
        <configured xmlns:cap="http://midpoint.evolveum.com/xml/ns/public/resource/capabilities-3">
            <cap:activation>
                <cap:status>
                    <cap:attribute>ri:roomNumber</cap:attribute>
                    <cap:enableValue/>
                    <cap:disableValue>disabled</cap:disableValue>
                </cap:status>
            </cap:activation>
            <cap:countObjects>
                <cap:simulate>pagedSearchEstimate</cap:simulate>
            </cap:countObjects>
        </configured>
    </capabilities>
    <caching>
        <cachingStrategy>passive</cachingStrategy>
        <defaultCacheUse>useFresh</defaultCacheUse>
    </caching>
    <business>
        <correlatorRef oid="00000000-0000-0000-0000-000000000002" type="UserType"/>
    </business>
</resource>
